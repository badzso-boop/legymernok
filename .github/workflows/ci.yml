name: CI Pipeline

on:
     push:
       branches: [ "main", "develop" ]
     pull_request:
       branches: [ "main", "develop" ]

jobs:
     # ---------------------------------------------------------------------------
     # Backend Job (Java + Maven)
     # ---------------------------------------------------------------------------
     backend-test:
       runs-on: ubuntu-latest

       defaults:
         run:
           working-directory: ./backend # Minden parancs ebben a mappában fut

       steps:
       - uses: actions/checkout@v4

       - name: Set up JDK 17
         uses: actions/setup-java@v4
         with:
           java-version: '17'
           distribution: 'temurin'
           cache: 'maven' # Maven függőségek cache-elése (gyorsabb build)

       - name: Build with Maven
         run: ./mvnw clean package -DskipTests

       - name: Run Tests
         run: ./mvnw test

     # ---------------------------------------------------------------------------
     # Frontend Job (Node.js + Vite)
     # ---------------------------------------------------------------------------
     frontend-build:
       runs-on: ubuntu-latest

       defaults:
         run:
           working-directory: ./frontend # Minden parancs ebben a mappában fut

       steps:
       - uses: actions/checkout@v4

       - name: Set up Node.js
         uses: actions/setup-node@v4
         with:
           node-version: '20'
           cache: 'npm'
           cache-dependency-path: './frontend/package-lock.json' # Fontos a monorepo miatt!

       - name: Install Dependencies
         run: npm ci

       - name: Build Project
         run: npm run build
         # Ha a build sikeres, az azt jelenti: nincs TypeScript hiba, nincs szintaktikai hiba